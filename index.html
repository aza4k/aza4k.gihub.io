<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Telegram Veb-ilova</title>
</head>
<body>
    <div id="user-info"></div>
    <div id="verification-status"></div>

    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script>
        Telegram.WebApp.ready();

        const userInfoDiv = document.getElementById('user-info');
        const verificationStatusDiv = document.getElementById('verification-status');

        if (Telegram.WebApp.initDataUnsafe) {
            const userData = Telegram.WebApp.initDataUnsafe.user;
            if (userData) {
                userInfoDiv.innerHTML = `
                    <h3>Foydalanuvchi ma'lumotlari:</h3>
                    <p>ID: ${userData.id}</p>
                    <p>Ism: ${userData.first_name || ''} ${userData.last_name || ''}</p>
                    <p>Foydalanuvchi nomi: ${userData.username || ''}</p>
                    <p>Til kodi: ${userData.language_code || ''}</p>
                    ${userData.photo_url ? `<img src="${userData.photo_url}" alt="Profil rasmi" width="50">` : ''}
                `;
            } else {
                userInfoDiv.innerText = 'Foydalanuvchi ma\'lumotlari mavjud emas.';
            }
        } else {
            userInfoDiv.innerText = 'Telegram Web App initData mavjud emas.';
        }

        const initData = Telegram.WebApp.initData;
        if (initData) {
            fetch('/verify_signature', { // aiohttp serveringiz manziliga moslang (masalan, https://yourdomain.com/verify_signature)
                method: 'POST',
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded',
                },
                body: `initData=${encodeURIComponent(initData)}`,
            })
            .then(response => response.json())
            .then(data => {
                if (data.status === 'ok') {
                    verificationStatusDiv.innerText = 'Imzo tekshirildi: Ma\'lumotlar haqiqiy.';
                } else {
                    verificationStatusDiv.innerText = `Imzo tekshirilmadi: ${data.message || 'Xatolik yuz berdi.'}`;
                }
            })
            .catch(error => {
                console.error('Imzoni tekshirishda xatolik:', error);
                verificationStatusDiv.innerText = 'Imzoni tekshirishda xatolik yuz berdi.';
            });
        } else {
            verificationStatusDiv.innerText = 'Xavfsiz initData mavjud emas.';
        }
    </script>
</body>
</html>